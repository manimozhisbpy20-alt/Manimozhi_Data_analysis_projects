
--01_CREATE_DDL_SCRIPT_FOR_SWIGGY.CSV

CREATE TABLE stg_swiggy_raw (
    state VARCHAR(100),
    city VARCHAR(100),
    order_date DATE,
    restaurant_name VARCHAR(255),
    location VARCHAR(255),
    category VARCHAR(100),
    dish_name VARCHAR(255),
    price_inr DECIMAL(10,2),
    rating DECIMAL(3,2),
    rating_count INT
);

--02_DEVELOP SQL LOAD SCRIPT
TRUNCATE TABLE stg_swiggy_raw
BULK INSERT stg_swiggy_raw
FROM 
WITH (
  FIRST ROW=2,
  FIELD TERMINATOR=',',
  TABLOCK
);

--03_data_validation_checks.sql
-- NULL check
SELECT
    SUM(CASE WHEN state IS NULL THEN 1 END) AS null_state,
    SUM(CASE WHEN city IS NULL THEN 1 END) AS null_city,
    SUM(CASE WHEN order_date IS NULL THEN 1 END) AS null_order_date,
    SUM(CASE WHEN restaurant_name IS NULL THEN 1 END) AS null_restaurant,
    SUM(CASE WHEN dish_name IS NULL THEN 1 END) AS null_dish,
    SUM(CASE WHEN price_inr IS NULL THEN 1 END) AS null_price
FROM stg_swiggy_raw;

--04_Blank check
SELECT *
FROM stg_swiggy_raw
WHERE TRIM(state) = '' 

05_remove_duplicates.sql

-- 02_remove_duplicates.sql
-- Remove duplicate rows keeping one copy per business key.
-- Business key = (state, city, order_date, restaurant_name, location, category, dish_name, price_inr)

WITH dedup AS (
  SELECT
    *,
    ROW_NUMBER() OVER (
      PARTITION BY
        state, city, order_date, restaurant_name, location, category, dish_name, price_inr
      ORDER BY
        order_date -- keep earliest/whatever rule you prefer
    ) AS rn
  FROM stg_swiggy_raw
)
-- Clean table: write to stg_swiggy_clean (or replace base)
SELECT
  state, city, order_date, restaurant_name, location, category, dish_name, price_inr, rating, rating_count
INTO stg_swiggy_clean
FROM dedup
WHERE rn = 1;
   OR TRIM(city)  = '' 
   OR TRIM(restaurant_name) = ''
   OR TRIM(location) = ''
   OR TRIM(category) = ''
   OR TRIM(dish_name) = '';
